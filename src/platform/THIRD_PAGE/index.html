<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Loading</title>
    </head>
    <style>
        html, body {
            padding: 0;
            margin: 0;
        }
    </style>
    <script>var bridge={default:this,call:function(b,a,c){var e="";"function"==typeof a&&(c=a,a={});a={data:void 0===a?"":a};if("function"==typeof c){var g="dscb"+window.dscb++;window[g]=c;a._dscbstub=g}a=JSON.stringify(a);if(window._dsbridge)e=_dsbridge.call(b,a);else if(window._dswk||-1!=navigator.userAgent.indexOf("_dsbridge"))e=prompt("_dsbridge="+b,a);return JSON.parse(e||"{}").data},register:function(b,a,c){c=c?window._dsaf:window._dsf;window._dsInit||(window._dsInit=!0,setTimeout(function(){bridge.call("_dsb.dsinit")},0));"object"==typeof a?c._obs[b]=a:c[b]=a},registerAsyn:function(b,a){this.register(b,a,!0)},hasNativeMethod:function(b,a){return this.call("_dsb.hasNativeMethod",{name:b,type:a||"all"})},disableJavascriptDialogBlock:function(b){this.call("_dsb.disableJavascriptDialogBlock",{disable:!1!==b})}};!function(){if(!window._dsf){var b={_dsf:{_obs:{}},_dsaf:{_obs:{}},dscb:0,dsBridge:bridge,close:function(){bridge.call("_dsb.closePage")},_handleMessageFromNative:function(a){var e=JSON.parse(a.data),b={id:a.callbackId,complete:!0},c=this._dsf[a.method],d=this._dsaf[a.method],h=function(a,c){b.data=a.apply(c,e);bridge.call("_dsb.returnValue",b)},k=function(a,c){e.push(function(a,c){b.data=a;b.complete=!1!==c;bridge.call("_dsb.returnValue",b)});a.apply(c,e)};if(c)h(c,this._dsf);else if(d)k(d,this._dsaf);else if(c=a.method.split("."),!(2>c.length)){a=c.pop();var c=c.join("."),d=this._dsf._obs,d=d[c]||{},f=d[a];f&&"function"==typeof f?h(f,d):(d=this._dsaf._obs,d=d[c]||{},(f=d[a])&&"function"==typeof f&&k(f,d))}}},a;for(a in b)window[a]=b[a];bridge.register("_hasJavascriptMethod",function(a,b){b=a.split(".");if(2>b.length)return!(!_dsf[b]&&!_dsaf[b]);a=b.pop();b=b.join(".");return(b=_dsf._obs[b]||_dsaf._obs[b])&&!!b[a]})}}();</script>
    <body onclick="init()">
        <input type=hidden data-view=go th:value='${paymentInfo}'>
    </body>
    <script>
        function parseUrl() {
            var url = location.href.split('?')
            var obj = {}
            if (url[1]) {
                var arr = url[1].split('&')
                for (var i = 0; i < arr.length; i++) {
                    var temp = arr[i].split('=')
                    obj[temp[0]] = temp[1]
                }
            }
            return obj
        }
        var paymentInfo = JSON.parse(document.querySelector('input[type=hidden]').value)
        var $tools = {
            postMessage(action, params) {
                window.parent.postMessage({params: params, action: action}, "*");
            }
        }
        // 通知父级页面, toThirdChargePage 异步方法
        function noticeParentPage() {
            dsBridge.call('toThirdChargePage', {url: paymentInfo.url})
            $tools.postMessage('toThirdChargePage', { url: paymentInfo.url})
        }
        // 支付完成关闭页面
        function payComplete(client) {
            client = client.toLowerCase()
            if (client === 'android') {
                dsBridge.call('payComplete', {url: paymentInfo.url})
            } else if (client === 'ios') {
                dsBridge.call('payComplete', {})
            } else {
                document.write('<p>client type is Empty!</p>')
            }
        }
        var params = parseUrl()
        function init() {
            if (params.client) {
                payComplete(params.client)
            } else {
                noticeParentPage()
            }
        }
        init()
    </script>
</html>
